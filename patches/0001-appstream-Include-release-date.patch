From 1a4652f0920e8851176f35acb92e30383fcf4768 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Jonah=20Br=C3=BCchert?= <jbb@kaidan.im>
Date: Fri, 26 Aug 2022 13:13:36 +0200
Subject: [PATCH] appstream: Include release date

---
 CMakeLists.txt                            | 1 +
 scripts/info.mumble.Mumble.appdata.xml.in | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 0d2f5e3ac..147e4a852 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -14,6 +14,7 @@ if(${CMAKE_VERSION} VERSION_GREATER_EQUAL "3.20.0")
 endif()
 
 set(BUILD_NUMBER CACHE STRING "The build number of the current build. Will be used in Mumble's version to make sure newer builds upgrade older installations properly.")
+set(BUILD_RELEASE_DATE CACHE STRING "The release date to be used in the generated appstream metadata.")
 
 if ("${BUILD_NUMBER}" STREQUAL "")
 	if(packaging)
diff --git a/scripts/info.mumble.Mumble.appdata.xml.in b/scripts/info.mumble.Mumble.appdata.xml.in
index 5040d6a3a..c55463c74 100644
--- a/scripts/info.mumble.Mumble.appdata.xml.in
+++ b/scripts/info.mumble.Mumble.appdata.xml.in
@@ -27,7 +27,7 @@
 	</screenshots>
 
 	<releases>
-		<release type="stable" version="@CMAKE_PROJECT_VERSION@"/>
+		<release type="stable" version="@CMAKE_PROJECT_VERSION@" date="@BUILD_RELEASE_DATE@" />
 	</releases>
 	<provides>
 		<binary>mumble</binary>
-- 
2.35.1

